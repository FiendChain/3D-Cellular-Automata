(this["webpackJsonpcellular-automaton"]=this["webpackJsonpcellular-automaton"]||[]).push([[0],{28:function(e,t,n){e.exports=n(41)},33:function(e,t,n){},41:function(e,t,n){"use strict";n.r(t),n.d(t,"store",(function(){return Se}));var a=n(0),r=n.n(a),i=n(15),s=n.n(i),o=(n(33),n(7)),c=n(4),u=n(22),l=n(8),h=n(2),_=n(3),d=n(13),f=n(14),v=function(){function e(t){Object(h.a)(this,e),this.gl=t,this.clear_colour=new Float32Array([1,1,1,1])}return Object(_.a)(e,[{key:"clear",value:function(){var e=this.gl;e.clearColor.apply(e,Object(l.a)(this.clear_colour)),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}},{key:"draw",value:function(e,t,n){var a=this.gl;n.bind(),e.bind(),t.bind(),a.drawElements(a.TRIANGLES,t.count,a.UNSIGNED_INT,0)}}]),e}(),m=n(1),p=function(){function e(){Object(h.a)(this,e),this.fov=50,this.aspect_ratio=1,this.view_position=m.c.fromValues(0,0,0),this.look_position=m.c.create(),this.target=m.c.fromValues(0,0,0),this.model_translation=m.c.create(),this.model=m.a.create(),this.view=m.a.create(),this.projection=m.a.create(),this.update()}return Object(_.a)(e,[{key:"update",value:function(){m.a.identity(this.model),m.a.translate(this.model,this.model,this.model_translation),m.a.scale(this.model,this.model,[1,1,1]),m.a.lookAt(this.view,this.view_position,this.target,[0,1,0]),m.a.perspective(this.projection,this.fov*Math.PI/180,this.aspect_ratio,.01,1e4)}},{key:"rotate",value:function(e,t){var n=m.a.create();m.a.rotateY(n,n,e);var a=m.c.create();m.c.sub(a,this.look_position,this.view_position),a[1]=this.look_position[1],m.c.rotateY(a,a,this.look_position,Math.PI/2),m.a.rotate(n,n,-t,a),m.c.transformMat4(this.view_position,this.view_position,n)}},{key:"zoom",value:function(e){var t=m.c.create();m.c.sub(t,this.view_position,this.look_position),m.c.scale(t,t,1+e),m.c.add(this.view_position,this.look_position,t)}}]),e}(),g=n(11),b=n.n(g),y=n(6),w=n(5),E=function(){function e(t,n){Object(h.a)(this,e),this.shape=t,this.count=t[0]*t[1]*t[2],this.stats=n,this.xyz_to_i_coefficients=[this.shape[0],this.shape[1]*this.shape[0]],this.cells=new Float32Array(this.count),this.cells_buffer=new Float32Array(this.count),this.neighbours=new Uint8Array(this.count),this.should_update=new Set,this.should_update_buffer=new Set,this.remove_queue=[],this.listeners=new Set,this.current_slice=null,this.slice_size=1e4,this.total_steps=0}return Object(_.a)(e,[{key:"listen_rerender",value:function(e){this.listeners.add(e)}},{key:"clear",value:function(){this.cells.fill(0,0,this.count),this.cells_buffer.fill(0,0,this.count),this.neighbours.fill(0,0,this.count),this.should_update.clear(),this.should_update_buffer.clear(),this.remove_queue=[],this.total_steps=0,this.stats.recieve({completed_blocks:0,total_blocks:0,total_steps:0})}},{key:"seed_updates",value:function(e){this.should_update.clear();for(var t=0;t<this.shape[0];t++)for(var n=0;n<this.shape[1];n++)for(var a=0;a<this.shape[2];a++){var r=this.xyz_to_i(t,n,a),i=this.cells[r];e.is_neighbour(i)&&e.on_location_update(t,n,a,this.shape,this.should_update)}this.stats.recieve({completed_blocks:0,total_blocks:this.should_update.size})}},{key:"step",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(null===this.current_slice&&(this.current_slice=this.sliced_step(e)),t){for(;!this.current_slice.next().done;);return this.current_slice=null,!0}var n=this.current_slice.next();return n.done&&(this.current_slice=null),n.done}},{key:"sliced_step",value:b.a.mark((function e(t){var n,a,r,i,s,o,c,u,l,h,_,d,f,v,m,p,g,E,x,k,O,j,T;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=performance.now(),a=0,r=0,i=this.should_update.size,this.stats.recieve({completed_blocks:r,total_blocks:i}),s=performance.now(),o=Object(y.a)(this.should_update),e.prev=7,o.s();case 9:if((c=o.n()).done){e.next=30;break}if(u=c.value,l=this.cells[u],h=this.i_to_xyz(u),_=Object(w.a)(h,3),d=_[0],f=_[1],v=_[2],m=t.count_neighbours(d,f,v,this.shape,this.cells),this.neighbours[u]=m,p=t.get_next_state(l,m),this.cells_buffer[u]=p,p===l?this.remove_queue.push(u):t.on_location_update(d,f,v,this.shape,this.should_update_buffer),r+=1,(a+=1)%this.slice_size!==0){e.next=28;break}if(a=0,!(performance.now()-s>=16)){e.next=28;break}return this.stats.recieve({completed_blocks:r}),void(e.next=27);case 27:s=performance.now();case 28:e.next=9;break;case 30:e.next=35;break;case 32:e.prev=32,e.t0=e.catch(7),o.e(e.t0);case 35:return e.prev=35,o.f(),e.finish(35);case 38:for(this.total_steps+=1,this.stats.recieve({completed_blocks:r,total_steps:this.total_steps}),g=this.cells,this.cells=this.cells_buffer,this.cells_buffer=g;this.remove_queue.length>0;)E=this.remove_queue.pop(),this.should_update.delete(E);x=this.should_update,this.should_update=this.should_update_buffer,this.should_update_buffer=x,k=performance.now(),O=k-n,this.stats.recieve({frame_time:O}),j=Object(y.a)(this.listeners);try{for(j.s();!(T=j.n()).done;)(0,T.value)(this)}catch(b){j.e(b)}finally{j.f()}return e.abrupt("return");case 53:case"end":return e.stop()}}),e,this,[[7,32,35,38]])}))},{key:"xyz_to_i",value:function(e,t,n){return e+t*this.xyz_to_i_coefficients[0]+n*this.xyz_to_i_coefficients[1]}},{key:"i_to_xyz",value:function(e){var t=Math.floor(e/this.xyz_to_i_coefficients[1]);e-=t*this.xyz_to_i_coefficients[1];var n=Math.floor(e/this.xyz_to_i_coefficients[0]);return[e-n*this.xyz_to_i_coefficients[0],n,t]}}]),e}(),x=function(){function e(t,n,a){Object(h.a)(this,e),this.gl=t,this.data=n,this.shape=a,this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_3D,this.texture),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_WRAP_R,t.CLAMP_TO_EDGE),t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.texImage3D(t.TEXTURE_3D,0,t.RG8,a[0],a[1],a[2],0,t.RG,t.UNSIGNED_BYTE,this.data)}return Object(_.a)(e,[{key:"bind",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.gl;t.activeTexture(t.TEXTURE0+e),t.bindTexture(t.TEXTURE_3D,this.texture)}}]),e}(),k=function(){function e(t,n,a){Object(h.a)(this,e),this.gl=t,this.data=n,this.shape=a,this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.texImage2D(t.TEXTURE_2D,0,t.RGBA8,a[0],a[1],0,t.RGBA,t.UNSIGNED_BYTE,this.data)}return Object(_.a)(e,[{key:"bind",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.gl;t.activeTexture(t.TEXTURE0+e),t.bindTexture(t.TEXTURE_2D,this.texture)}}]),e}(),O=n(19),j=n.n(O),T=b.a.mark(N),S=function(){function e(t,n,a,r,i,s,o){var c=this;Object(h.a)(this,e),this.gl=t,this.camera=a,this.size=n,this.stats=o,this.total_cells=n[0]*n[1]*n[2],this.running=!1,this.total_queued_steps=0,this.shader_manager=r,this.rule_browser=i,this.randomiser_browser=s,this.create_data(),this.sim=new E(this.size,o),this.sim.listen_rerender((function(e){return c.update_vertex_buffer(!0)}))}return Object(_.a)(e,[{key:"create_data",value:function(){var e=this.gl;this.state_colour_texture=this.create_states_texture(),this.radius_colour_texture=this.create_radius_texture(),this.cell_data_width=2,this.cell_data=new Uint8Array(this.total_cells*this.cell_data_width),this.cell_data_texture=new x(e,this.cell_data,this.size)}},{key:"create_states_texture",value:function(){for(var e=this.gl,t=new Uint8Array(160),n=0;n<39;n++){var a=4*(n+1),r=200*(1-n/40),i=j.a.hsv_to_rgb(r,100,100),s=i.r,o=i.g,c=i.b;t[a+0]=s,t[a+1]=o,t[a+2]=c,t[a+3]=255}for(var u=0;u<4;u++)t[u]=0;return new k(e,t,[40,1])}},{key:"create_radius_texture",value:function(){for(var e=this.gl,t=new Uint8Array(1440),n=0;n<360;n++){var a=4*n,r=360*(1-n/360),i=j.a.hsv_to_rgb(r,100,100),s=i.r,o=i.g,c=i.b;t[a+0]=s,t[a+1]=o,t[a+2]=c,t[a+3]=255}return new k(e,t,[360,1])}},{key:"clear",value:function(){this.sim.clear(),this.update_vertex_buffer()}},{key:"randomise",value:function(){var e=this.rule_browser.get_selected_entry().rule;this.randomiser_browser.selected_randomiser.randomise(this.sim),this.sim.seed_updates(e),this.update_vertex_buffer()}},{key:"on_update",value:function(){if(this.camera.update(),this.running&&(this.total_queued_steps=1),this.total_queued_steps>0){var e=this.rule_browser.get_selected_entry().rule;this.sim.step(e)&&(this.total_queued_steps=0)}}},{key:"start",value:function(){this.running=!0}},{key:"stop",value:function(){this.running=!1,this.total_queued_steps=0}},{key:"toggle",value:function(){this.running?this.stop():this.start()}},{key:"step",value:function(){this.total_queued_steps=1}},{key:"update_vertex_buffer",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=this.gl,a=t?this.sim.should_update:N(0,this.sim.count),r=this.rule_browser.get_selected_entry().rule,i=r.neighbours,s=i.max_neighbours,o=Object(y.a)(a);try{for(o.s();!(e=o.n()).done;){var c=e.value,u=c*this.cell_data_width,l=this.sim.cells[c],h=this.sim.neighbours[c];this.cell_data[u+0]=Math.floor(255*l),this.cell_data[u+1]=Math.floor(Math.min(h,s)/s*255)}}catch(_){o.e(_)}finally{o.f()}this.cell_data_texture.bind(),n.texSubImage3D(n.TEXTURE_3D,0,0,0,0,this.size[0],this.size[1],this.size[2],n.RG,n.UNSIGNED_BYTE,this.cell_data,0)}},{key:"on_render",value:function(){this.shader_manager.bind(),this.cell_data_texture.bind(0),this.state_colour_texture.bind(1),this.radius_colour_texture.bind(2),this.shader_manager.on_render()}}]),e}();function N(e,t){var n;return b.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:n=e;case 1:if(!(n<t)){a.next=7;break}return a.next=4,n;case 4:n++,a.next=1;break;case 7:case"end":return a.stop()}}),T)}var R=function(){function e(t,n,a){Object(h.a)(this,e),this.gl=t,this.create_shader_program(n,a),this.uniforms=[],this.locations=[]}return Object(_.a)(e,[{key:"create_shader_program",value:function(e,t){var n=function(e,t,n){var a=e.createShader(e.VERTEX_SHADER);if(e.shaderSource(a,t),e.compileShader(a),!e.getShaderParameter(a,e.COMPILE_STATUS))throw console.error(e.getShaderInfoLog(a)),console.error(z(t)),new Error("Unable to compile vertex shader");var r=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(r,n),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw console.error(e.getShaderInfoLog(r)),new Error("Unable to compile fragment shader");var i=e.createProgram();if(e.attachShader(i,a),e.attachShader(i,r),e.linkProgram(i),!e.getProgramParameter(i,e.LINK_STATUS))throw console.error(e.getProgramInfoLog(i)),console.error(z(n)),new Error("Unable to construct shader program");return[a,r,i]}(this.gl,e,t),a=Object(w.a)(n,3);this.vertex_shader=a[0],this.fragment_shader=a[1],this.program=a[2]}},{key:"add_uniform",value:function(e,t){var n=this.gl.getUniformLocation(this.program,e);this.uniforms.push(t),this.locations.push(n)}},{key:"bind",value:function(){this.gl.useProgram(this.program);for(var e=0;e<this.uniforms.length;e++){var t=this.uniforms[e],n=this.locations[e];null!==n&&t.apply(n)}}}]),e}();function z(e){return e.split("\n").map((function(e,t){return"".concat(t+1,"\t| ").concat(e)})).join("\n")}var A=function(){function e(t,n,a){Object(h.a)(this,e),this.gl=t,this.data=n,this.vbo=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.vbo),t.bufferData(t.ARRAY_BUFFER,n,a)}return Object(_.a)(e,[{key:"bind",value:function(){var e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,this.vbo)}}]),e}(),C=function(){function e(t){Object(h.a)(this,e),this.gl=t,this.vao=t.createVertexArray(),this.integer_types=new Set([t.INT,t.UNSIGNED_INT])}return Object(_.a)(e,[{key:"add_vertex_buffer",value:function(e,t){var n=this.gl;this.bind(),e.bind();var a,r=0,i=Object(y.a)(t.attributes);try{for(i.s();!(a=i.n()).done;){var s=a.value;n.enableVertexAttribArray(s.index),this.integer_types.has(s.type)?n.vertexAttribIPointer(s.index,s.count,s.type,s.is_normalised,t.stride,r):n.vertexAttribPointer(s.index,s.count,s.type,s.is_normalised,t.stride,r),r+=s.count*s.size}}catch(o){i.e(o)}finally{i.f()}}},{key:"bind",value:function(){this.gl.bindVertexArray(this.vao)}}]),e}(),P=function(){function e(t){Object(h.a)(this,e),this.gl=t,this.stride=0,this.attributes=[]}return Object(_.a)(e,[{key:"push_attribute",value:function(e,t,n,a){var r=this.sizeof(n),i=new M(e,t,n,a,r);this.attributes.push(i),this.stride+=t*r}},{key:"slice",value:function(t,n){var a=new e;return a.stride=this.stride,a.attributes=this.attributes.slice(t,n),a}},{key:"sizeof",value:function(e){var t=this.gl;switch(e){case t.FLOAT:case t.UNSIGNED_INT:case t.INT:return 4;default:throw new Error("Unknown element type: ".concat(e))}}}]),e}(),M=function e(t,n,a,r,i){Object(h.a)(this,e),this.index=t,this.count=n,this.type=a,this.is_normalised=r,this.size=i},F=function(){function e(t,n){Object(h.a)(this,e),this.gl=t,this.buffer=t.createBuffer(),this.count=n.length,t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,n,t.STATIC_DRAW)}return Object(_.a)(e,[{key:"bind",value:function(){var e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.buffer)}}]),e}(),U=function(){function e(t,n){Object(h.a)(this,e),this.gl=t,this.data=n}return Object(_.a)(e,[{key:"apply",value:function(e){this.gl.uniformMatrix4fv(e,!1,this.data)}}]),e}(),D=function(){function e(t,n){Object(h.a)(this,e),this.gl=t,this.data=n}return Object(_.a)(e,[{key:"apply",value:function(e){this.gl.uniform3f(e,this.data[0],this.data[1],this.data[2])}}]),e}(),I=function(){function e(t,n){Object(h.a)(this,e),this.gl=t,this.data=n}return Object(_.a)(e,[{key:"apply",value:function(e){this.gl.uniform4f(e,this.data[0],this.data[1],this.data[2],this.data[3])}}]),e}(),V=function(){function e(t){Object(h.a)(this,e),this.callback=t}return Object(_.a)(e,[{key:"apply",value:function(e){this.callback(e)}}]),e}(),G="\nprecision mediump float;\n\nattribute vec3 position;\nattribute vec3 normal;\n\nuniform mat4 uModel;\nuniform mat4 uView;\nuniform mat4 uProjection;\nuniform vec3 uOffset;\n\nvoid main() {\n    mat4 MVP = uProjection * uView * uModel;\n    gl_Position = MVP * vec4(position + uOffset, 1);\n}",L="\nprecision mediump float;\n\nuniform vec4 uColour;\n\nvoid main() {\n    gl_FragColor = uColour;\n}";var B={vertex_data:function(e,t,n,a,r,i){return new Float32Array([e,i,n,0,0,1,t,i,n,0,0,1,e,r,n,0,0,1,t,r,n,0,0,1,e,r,n,0,1,0,e,r,a,0,1,0,t,r,a,0,1,0,t,r,n,0,1,0,t,r,n,1,0,0,t,i,n,1,0,0,t,i,a,1,0,0,t,r,a,1,0,0,e,r,n,-1,0,0,e,r,a,-1,0,0,e,i,n,-1,0,0,e,i,a,-1,0,0,e,i,n,0,-1,0,e,i,a,0,-1,0,t,i,a,0,-1,0,t,i,n,0,-1,0,e,r,a,0,0,-1,t,r,a,0,0,-1,e,i,a,0,0,-1,t,i,a,0,0,-1])},index_data:new Uint32Array([0,3,2,0,1,3,4,6,5,4,7,6,8,9,11,9,10,11,13,14,12,13,15,14,16,18,19,16,17,18,20,21,22,21,23,22])};new Uint32Array([0,1,2,1,3,2,2,3,6,3,7,6,1,5,3,5,7,3,0,2,6,0,6,4,4,1,0,1,4,5,5,6,7,5,4,6]);var X=function(){function e(t,n){Object(h.a)(this,e);var a=this.generate(t,n),r=Object(w.a)(a,2),i=r[0],s=r[1];this.size=t,this.thickness=n,this.vertex_data=new Float32Array(i),this.index_data=new Uint32Array(s)}return Object(_.a)(e,[{key:"generate",value:function(e,t){var n=[],a=[],r=0;function i(e){var t=Object(w.a)(e,2),i=t[0],s=t[1];n.push.apply(n,Object(l.a)(i));var o=s.map((function(e){return e+r}));a.push.apply(a,Object(l.a)(o)),r+=24}for(var s=m.c.fromValues(t,t,t),o=0,c=[0,e[0]];o<c.length;o++)for(var u=c[o],h=0,_=[0,e[1]];h<_.length;h++)for(var d=_[h],f=0,v=[0,e[2]];f<v.length;f++){var p=v[f];i(this.create_cube([u,d,p],s))}s=m.c.fromValues(e[0]-t,t,t);for(var g=0,b=[0,e[1]];g<b.length;g++)for(var y=b[g],E=0,x=[0,e[2]];E<x.length;E++){var k=x[E],O=e[0]/2;i(this.create_cube([O,y,k],s))}s=m.c.fromValues(t,e[1]-t,t);for(var j=0,T=[0,e[0]];j<T.length;j++)for(var S=T[j],N=0,R=[0,e[2]];N<R.length;N++){var z=R[N],A=e[1]/2;i(this.create_cube([S,A,z],s))}s=m.c.fromValues(t,t,e[2]-t);for(var C=0,P=[0,e[0]];C<P.length;C++)for(var M=P[C],F=0,U=[0,e[1]];F<U.length;F++){var D=U[F],I=e[2]/2;i(this.create_cube([M,D,I],s))}return[n,a]}},{key:"create_cube",value:function(e,t){var n=e[0]-t[0]/2,a=e[0]+t[0]/2,r=e[1]+t[1]/2,i=e[1]-t[1]/2,s=e[2]-t[2]/2,o=e[2]+t[2]/2;return[B.vertex_data(n,a,s,o,r,i),B.index_data]}}]),e}(),Y=function(){function e(t,n,a,r){Object(h.a)(this,e),this.gl=t,this.renderer=a,this.camera=r;var i=m.c.create();m.c.add(i,n,m.c.fromValues(1,1,1));var s=m.c.fromValues(-.5,-.5,-.5);this.border=new X(i,.2),this.shader=new R(t,G,L),this.vbo=new A(t,this.border.vertex_data,t.STATIC_DRAW),this.index_buffer=new F(t,this.border.index_data);var o=new P(t);o.push_attribute(0,3,t.FLOAT,!1),o.push_attribute(1,3,t.FLOAT,!1),this.vao=new C(t),this.vao.add_vertex_buffer(this.vbo,o),this.shader.add_uniform("uModel",new U(t,this.camera.model)),this.shader.add_uniform("uView",new U(t,this.camera.view)),this.shader.add_uniform("uProjection",new U(t,this.camera.projection)),this.shader.add_uniform("uColour",new I(t,m.d.fromValues(0,0,0,1))),this.shader.add_uniform("uOffset",new D(t,s))}return Object(_.a)(e,[{key:"on_render",value:function(){this.renderer.draw(this.vao,this.index_buffer,this.shader)}}]),e}(),q=n(9),W={basic:{create:function(e){return"#version 300 es\n\nprecision highp float;\nprecision highp int;\n\nin vec4 vColour;\nin vec3 vFragPos;\nin vec3 vNormal;\n\nout vec4 fragColour;\n\nstruct Light {\n    vec3 position;\n    vec3 colour;\n};\n\nuniform Light light;\n\nuniform vec3 uViewPosition;\nuniform float uSpecularPowerFactor;\nfloat uSpecularScattering = 0.1;\n\n// vec3 uSkyTop =  vec3( 0.1, 0.2, 0.8 ) * 0.5;\n// vec3 uSkyBottom = vec3( 0.5, 0.8, 1.0 ) * 1.5;\n// vec3 uSunColour = vec3(1.0, 1.2, 1.4);\n\nvec3 uSkyTop =  vec3( 0.8, 0.8, 0.8 ) * 0.5;\nvec3 uSkyBottom = vec3( 0.8, 0.8, 0.8 ) * 1.5;\nvec3 uSunColour = vec3(1.0, 1.0, 1.0);\n\n\nfloat uFloorHeight = 0.0;\nfloat uAmbientOcclusionStrength = 0.8;\nfloat uAmbientOcclusionRange = 100.0;\n\nuniform float uSkyStrength;\nuniform float uSunStrength;\n\nvec4 uFogColour = vec4(1,1,1,1);\nuniform float uFogNear;\nuniform float uFogFar;\nfloat uFogRange = 1000.0;\n\nvec3 get_sun_direction() {\n    return normalize(vec3(20.0, 40.3, -10.4));\n}\n\nvec3 get_sun_lighting(const vec3 normal) {\n    vec3 light_direction = -get_sun_direction();\n    float angle = max(dot(normal, -light_direction), 0.0);\n    return uSunColour * uSunStrength * angle;\n}\n\nvec3 get_sky_lighting(const vec3 normal) {\n    float sky_blend = normal.y * 0.5 + 0.5;\n    vec3 sky_light = mix(uSkyBottom, uSkyTop, sky_blend);\n    return sky_light * uSkyStrength;  \n}\n\nvec3 get_sky_colour(vec3 view_direction) {\n    vec3 sky_colour = mix(uSkyBottom, uSkyTop, max(view_direction.y, 0.0));\n    return sky_colour * uSkyStrength;\n}\n\nvec4 apply_ambient_occlusion(const vec4 colour, const vec3 position) {\n    float height = (position.y - uFloorHeight) / uAmbientOcclusionRange;\n    height = abs(height);\n    float occlusion = mix(1.0, 1.0-uAmbientOcclusionStrength, clamp(0.0, 1.0, height));\n    return vec4(colour.xyz * occlusion, colour.a);\n}\n\nvec4 apply_fog(const vec4 colour, float distance) {\n    float norm_distance = distance / uFogRange;\n    float fog_strength = clamp(norm_distance, uFogNear, uFogFar);\n    return mix(colour, uFogColour, fog_strength);\n}\n\nvoid main() {\n    vec3 normal = normalize(vNormal);\n    vec3 view_direction = normalize(uViewPosition - vFragPos);\n\n    vec3 sky_lighting = get_sky_lighting(normal);\n    vec3 sky_colour = get_sky_colour(view_direction);\n    vec3 sun_lighting = get_sun_lighting(normal);\n    vec3 total_lighting = sky_lighting + sun_lighting + sky_colour;\n\n    vec4 result = vec4(total_lighting, 1) * vColour; \n    // result = apply_ambient_occlusion(result, vFragPos);\n\n    float distance = length(uViewPosition-vFragPos);\n    result = apply_fog(result, distance);\n\n    fragColour = result;\n}"},point_cloud:!1},basic_alternate:{create:function(e){return"#version 300 es\n\nprecision highp float;\nprecision highp int;\n\nin vec4 vColour;\nin vec3 vFragPos;\nin vec3 vNormal;\n\nout vec4 fragColour;\n\nstruct Light {\n    vec3 position;\n    vec3 colour;\n};\n\nuniform Light light;\n\nuniform float uAmbientStrength;\nuniform float uDiffuseStrength;\nuniform float uSpecularStrength;\n\nuniform vec3 uViewPosition;\nuniform float uSpecularPowerFactor;\nfloat uSpecularScattering = 0.1;\n\nvoid main() {\n    vec3 normal = normalize(vNormal);\n\n    vec3 ambient = uAmbientStrength * light.colour;\n\n    vec3 light_position = vec3(-uViewPosition.x, uViewPosition.y, -uViewPosition.z);\n    vec3 light_direction = normalize(light_position - vFragPos);\n\n    float diff = max(dot(normal, light_direction), 0.0);\n    vec3 diffuse = diff * uDiffuseStrength * light.colour;\n\n    vec3 view_direction = normalize(uViewPosition - vFragPos);\n    vec3 reflect_direction = reflect(-light_direction, normal);\n    float spec = dot(view_direction, reflect_direction);\n    spec = clamp(spec + uSpecularScattering, 0.0, 1.0);\n    spec = pow(spec, uSpecularPowerFactor);\n    vec3 specular = uSpecularStrength * spec * light.colour;\n    \n    vec3 total_lighting = (ambient + diffuse + specular) * vColour.xyz;\n    vec4 result = vec4(total_lighting, 1.0);\n\n    fragColour = result;\n}"},point_cloud:!1},no_shading:{create:function(e){return"#version 300 es\n\nprecision highp float;\nprecision highp int;\n\nuniform float uBrightness;\n\nin vec4 vColour;\n".concat(e?"":"in vec3 vNormal;","\n").concat(e?"":"in vec3 vFragPos;","\n\nout vec4 fragColour;\n\nvoid main() {\n    fragColour = vec4(vColour.xyz * uBrightness, vColour.a);\n}")},point_cloud:!0}},H="\n".concat("vec3 calculate_offset(int index) {\n    float remain = float(index);\n    float z = floor(remain/(uGridSize.x*uGridSize.y));\n    remain = remain - z*uGridSize.x*uGridSize.y;\n    float y = floor(remain/uGridSize.x);\n    float x = remain-y*uGridSize.x; \n    return vec3(x, y, z);\n}","\n").concat("\nvec3 scale_position(float scale, vec3 pos) {\n    float K = max(scale, float(1-uScalingEnabled));\n    vec3 delta = pos-uCenter;\n    return uCenter + (K*delta);\n}\n","\n").concat("mat3 Rx(float a) {\n    return mat3(\n        1., 0., 0.,\n        0., cos(a), sin(a),\n        0., -sin(a), cos(a)\n    );\n}\n\nmat3 Ry(float a) {\n    return mat3(\n        cos(a), 0., -sin(a),\n        0, 1., 0.,\n        sin(a), 0., cos(a)\n    );\n}\n\nvec3 calculate_point_cloud(const vec3 pos, const vec3 offset) {\n    vec3 point_position = offset+uCenter-(uGridSize/2.0);\n    vec3 view_direction = uViewPosition-point_position;\n    vec2 xz = vec2(view_direction.x, view_direction.z);\n    float r = length(xz);\n    float ay = atan(view_direction.x, view_direction.z);\n    float ax = -atan(view_direction.y, r);\n    mat3 R = Ry(ay) * Rx(ax);\n    return R*(pos-uCenter) + uCenter + offset; \n}","\n").concat("\nvec4 get_cell_data(vec3 offset) {\n    vec3 vol_tex_coords = offset / uGridSize;\n    vec4 cell = texture(uStateTexture, vol_tex_coords);\n    return cell;\n}\n","\n"),K=function(e){return"#version 300 es\n\nprecision highp float;\nprecision highp sampler3D;\nprecision highp sampler2D;\nprecision highp int;\n\nin vec3 position;\n".concat(e?"":"in vec3 normal;","\n\n// MVP\nuniform mat4 uModel;\nuniform mat4 uView;\nuniform mat4 uProjection;\nuniform vec3 uViewPosition;\nuniform vec3 uGridSize;\n// params\nuniform int uScalingEnabled;\n// texturing\nuniform sampler2D uStateColourTexture;\nuniform sampler2D uRadiusColourTexture;\nuniform sampler3D uStateTexture;\n\nvec3 uCenter = vec3(0.5, 0.5, 0.5);\n\nout vec4 vColour;\n").concat(e?"":"out vec3 vNormal;","\n").concat(e?"":"out vec3 vFragPos;","\n\n").concat(H,"\n")},J=function(e){return"\n".concat(e?"vPosition = calculate_point_cloud(vPosition, offset);":"vPosition = vPosition + offset;","\n\n// pass through data\nvPosition *= vColour.a;\nmat4 MVP = uProjection * uView * uModel;\n").concat(e?"":"vNormal = normal;","\n").concat(e?"":"vFragPos = vec3(uModel * vec4(vPosition, 1.0));","\ngl_Position = MVP * vec4(vPosition, 1.0);\n")},Q={state:function(e){return"".concat(K(e),"\nvoid main() {\n    ").concat("\n// get basic info about cell\nvec3 offset = calculate_offset(gl_InstanceID);\nvec4 cell = get_cell_data(offset);\nfloat state = cell[0];\nfloat neighbours = cell[1];\nvec4 state_colour =  texture(uStateColourTexture, vec2(state,0));\n","\n    vec3 vPosition = scale_position(state, position);\n    vColour = state_colour;\n    ").concat(J(e),"\n}")},xyz:function(e){return"".concat(K(e),"\nvoid main() {\n    ").concat("\n// get basic info about cell\nvec3 offset = calculate_offset(gl_InstanceID);\nvec4 cell = get_cell_data(offset);\nfloat state = cell[0];\nfloat neighbours = cell[1];\nvec4 state_colour =  texture(uStateColourTexture, vec2(state,0));\n","\n    vec3 vPosition = scale_position(state, position);\n    vec3 xyz_colour = offset / uGridSize;\n    vColour = vec4(xyz_colour, state_colour.a);\n    ").concat(J(e),"\n}\n")},layer:function(e){return"".concat(K(e),"\nvoid main() {\n    ").concat("\n// get basic info about cell\nvec3 offset = calculate_offset(gl_InstanceID);\nvec4 cell = get_cell_data(offset);\nfloat state = cell[0];\nfloat neighbours = cell[1];\nvec4 state_colour =  texture(uStateColourTexture, vec2(state,0));\n","\n    vec3 vPosition = scale_position(state, position);\n    vec3 distance = offset - (uGridSize/2.0);\n    float dist = length(distance/10.0);\n    dist = mod(dist, 1.0);\n    vec4 dist_colour = texture(uRadiusColourTexture, vec2(dist, 0.0));\n    vColour = vec4(dist_colour.xyz, state_colour.a);\n    ").concat(J(e),"\n}")},radius:function(e){return"".concat(K(e),"\nvoid main() {\n    ").concat("\n// get basic info about cell\nvec3 offset = calculate_offset(gl_InstanceID);\nvec4 cell = get_cell_data(offset);\nfloat state = cell[0];\nfloat neighbours = cell[1];\nvec4 state_colour =  texture(uStateColourTexture, vec2(state,0));\n","\n    vec3 xyz_center = uGridSize/2.0;\n    vec3 distance = offset-xyz_center;\n    float radius = length(distance/xyz_center);\n    float total_repeats = 1.0;\n    radius = clamp(radius, 0.0, 1.0) * total_repeats;\n    vec4 radius_colour = texture(uRadiusColourTexture, vec2(radius, 0.0));\n\n    vec3 vPosition = scale_position(state, position);\n    vColour = vec4(radius_colour.xyz, state_colour.a);\n    ").concat(J(e),"\n}")},neighbour:function(e){return"".concat(K(e),"\nvoid main() {\n    ").concat("\n// get basic info about cell\nvec3 offset = calculate_offset(gl_InstanceID);\nvec4 cell = get_cell_data(offset);\nfloat state = cell[0];\nfloat neighbours = cell[1];\nvec4 state_colour =  texture(uStateColourTexture, vec2(state,0));\n","\n    vec4 neighbour_colour = texture(uStateColourTexture, vec2(neighbours, 0.0));\n\n    vec3 vPosition = scale_position(neighbours, position);\n    vColour = neighbour_colour;\n    ").concat(J(e),"\n}")},neighbour_and_alive:function(e){return"".concat(K(e),"\nvoid main() {\n    ").concat("\n// get basic info about cell\nvec3 offset = calculate_offset(gl_InstanceID);\nvec4 cell = get_cell_data(offset);\nfloat state = cell[0];\nfloat neighbours = cell[1];\nvec4 state_colour =  texture(uStateColourTexture, vec2(state,0));\n","\n    vec4 neighbour_colour = texture(uStateColourTexture, vec2(neighbours, 0.0));\n\n    vec3 vPosition = scale_position(neighbours, position);\n    vColour = vec4(neighbour_colour.xyz, state_colour.a*neighbour_colour.a);\n    ").concat(J(e),"\n}")}},Z=function e(t){Object(h.a)(this,e),this.type="toggle",this.value=t},$=function(){function e(t,n,a){Object(h.a)(this,e),this.type="slider",this.min=t,this.max=n,this.value=a}return Object(_.a)(e,[{key:"clamp",value:function(e){return e<this.min&&(e=this.min),e>this.max&&(e=this.max),e}},{key:"value",set:function(e){e=this.clamp(e),this._value=e},get:function(){return this._value}}]),e}(),ee=function(){function e(t,n){Object(h.a)(this,e),this.gl=t,this.size=m.c.create(),this.total_cells=0,this.light_position=m.c.create(),this.camera=n,this.global_params={ambient_strength:new $(0,1,.4),diffuse_strength:new $(0,1,.95),specular_strength:new $(0,1,.6),specular_power_factor:new $(0,128,4),scaling_enabled:new Z(0),fog_near:new $(0,1,0),fog_far:new $(0,1,0),sun_strength:new $(0,1,.95),sky_strength:new $(0,1,.25),brightness:new $(0,1,.9)},this.create_options(),this.set_available_shadings(),this.create_shader(),this.create_params()}return Object(_.a)(e,[{key:"set_available_shadings",value:function(){for(var e=this.render_types[this.current_render_type],t=[],n=0;n<this.all_shadings.length;n++){var a=this.all_shadings[n],r=W[a];e.point_cloud&&!r.point_cloud||t.push(a)}this.shadings=t,this.current_shading=0}},{key:"create_options",value:function(){for(var e in this.render_types=[ne(this.gl),ae(this.gl),te(this.gl)],this.colourings=[],this.all_shadings=[],this.shadings=[],this.shadings_params={basic:["sun_strength","sky_strength","fog_near","fog_far","scaling_enabled"],basic_alternate:["ambient_strength","diffuse_strength","specular_strength","specular_power_factor","scaling_enabled"],no_shading:["brightness","scaling_enabled"]},Q)this.colourings.push(e);for(var t in W)this.all_shadings.push(t);this.current_render_type=0,this.current_colouring=0,this.current_shading=0}},{key:"create_shader",value:function(){var e=this.colourings[this.current_colouring],t=this.shadings[this.current_shading],n=this.render_types[this.current_render_type],a=Q[e],r=W[t];if(n.point_cloud&&!r.point_cloud)for(var i=0;i<this.shadings.length;i++){var s=this.shadings[i];if(W[s].point_cloud)return this.current_shading=i,this.create_shader()}var o=a(n.point_cloud),c=r.create(n.point_cloud);this.shader=new R(this.gl,o,c),this.add_uniforms(this.shader)}},{key:"create_params",value:function(){var e,t=this.shadings[this.current_shading],n=this.shadings_params[t],a={},r=Object(y.a)(n);try{for(r.s();!(e=r.n()).done;){var i=e.value,s=this.global_params[i];a[i]=s}}catch(o){r.e(o)}finally{r.f()}this.params=a}},{key:"set_size",value:function(e){for(var t=0;t<3;t++)this.size[t]=e[t];this.total_cells=e[0]*e[1]*e[2],m.c.scale(this.light_position,this.size,2.5)}},{key:"set_param",value:function(e,t){this.params[e].value=t,this.params=Object(q.a)({},this.params)}},{key:"select_render_type",value:function(e){this.current_render_type=e,this.set_available_shadings(),this.create_shader(),this.create_params()}},{key:"select_colouring",value:function(e){this.current_colouring=e,this.create_shader(),this.create_params()}},{key:"select_shading",value:function(e){this.current_shading=e,this.create_shader(),this.create_params()}},{key:"bind",value:function(){this.shader.bind();var e=this.render_types[this.current_render_type];e.vao.bind(),e.index_buffer.bind()}},{key:"on_render",value:function(){var e=this.gl,t=this.render_types[this.current_render_type];e.drawElementsInstanced(e.TRIANGLES,t.index_buffer.count,e.UNSIGNED_INT,t.index_data,this.total_cells)}},{key:"add_uniforms",value:function(e){var t=this,n=this.gl;e.add_uniform("uModel",new U(n,this.camera.model)),e.add_uniform("uView",new U(n,this.camera.view)),e.add_uniform("uProjection",new U(n,this.camera.projection)),e.add_uniform("uGridSize",new D(n,this.size)),e.add_uniform("uViewPosition",new D(n,this.camera.view_position)),e.add_uniform("light.position",new D(n,this.light_position)),e.add_uniform("light.colour",new D(n,m.c.fromValues(1,1,1))),e.add_uniform("uAmbientStrength",new V((function(e){return n.uniform1f(e,t.global_params.ambient_strength.value)}))),e.add_uniform("uDiffuseStrength",new V((function(e){return n.uniform1f(e,t.global_params.diffuse_strength.value)}))),e.add_uniform("uSpecularStrength",new V((function(e){return n.uniform1f(e,t.global_params.specular_strength.value)}))),e.add_uniform("uSpecularPowerFactor",new V((function(e){return n.uniform1f(e,t.global_params.specular_power_factor.value)}))),e.add_uniform("uBrightness",new V((function(e){return n.uniform1f(e,t.global_params.brightness.value)}))),e.add_uniform("uStateTexture",new V((function(e){return n.uniform1i(e,0)}))),e.add_uniform("uStateColourTexture",new V((function(e){return n.uniform1i(e,1)}))),e.add_uniform("uRadiusColourTexture",new V((function(e){return n.uniform1i(e,2)}))),e.add_uniform("uScalingEnabled",new V((function(e){return n.uniform1i(e,t.global_params.scaling_enabled.value)}))),e.add_uniform("uFogNear",new V((function(e){return n.uniform1f(e,t.global_params.fog_near.value)}))),e.add_uniform("uFogFar",new V((function(e){return n.uniform1f(e,t.global_params.fog_far.value)}))),e.add_uniform("uSunStrength",new V((function(e){return n.uniform1f(e,t.global_params.sun_strength.value)}))),e.add_uniform("uSkyStrength",new V((function(e){return n.uniform1f(e,t.global_params.sky_strength.value)})))}}]),e}(),te=function(e){var t=new P(e);t.push_attribute(0,3,e.FLOAT,!1),t.push_attribute(1,3,e.FLOAT,!1);var n=B.vertex_data(0,1,1,0,1,0),a=B.index_data,r=new A(e,n,e.STATIC_DRAW),i=new F(e,a),s=new C(e);return s.add_vertex_buffer(r,t),{name:"cube",vao:s,index_buffer:i,index_data:a,point_cloud:!1}},ne=function(e){var t=new P(e);t.push_attribute(0,3,e.FLOAT,!1);var n=new Float32Array([0,1,.5,1,1,.5,0,0,.5,1,0,.5]),a=new Uint32Array([2,1,0,2,3,1]),r=new A(e,n,e.STATIC_DRAW),i=new F(e,a),s=new C(e);return s.add_vertex_buffer(r,t),{name:"quad point cloud",vao:s,index_buffer:i,index_data:a,point_cloud:!0}},ae=function(e){var t=new P(e);t.push_attribute(0,3,e.FLOAT,!1);var n=new Float32Array([-.5,-.5,.5,1.5,-.5,.5,.5,-1.5,.5]),a=new Uint32Array([2,1,0]),r=new A(e,n,e.STATIC_DRAW),i=new F(e,a),s=new C(e);return s.add_vertex_buffer(r,t),{name:"triangle point cloud",vao:s,index_buffer:i,index_data:a,point_cloud:!0}},re=function(){function e(t,n,a,r){Object(h.a)(this,e),this.remain_alive=t,this.become_alive=n,this.total_states=a,this.alive_state=1,this.dead_state=0,this.delta=(this.alive_state-this.dead_state)/(this.total_states-1),this.alive_threshold=this.alive_state-this.delta/2,this.dead_threshold=this.delta/2,this.neighbours=r}return Object(_.a)(e,[{key:"count_neighbours",value:function(e,t,n,a,r){return this.neighbours.count_neighbours(e,t,n,a,r,this)}},{key:"on_location_update",value:function(e,t,n,a,r){this.neighbours.on_location_update(e,t,n,a,r)}},{key:"get_next_state",value:function(e,t){return this.is_alive(e)?this.remain_alive(t)?e:e-this.delta:this.is_dead(e)?this.become_alive(t)?this.alive_state:e:e-this.delta}},{key:"is_neighbour",value:function(e){return e===this.alive_state}},{key:"is_alive",value:function(e){return e>this.alive_threshold}},{key:"is_dead",value:function(e){return e<this.dead_threshold}}]),e}();function ie(e,t,n,a){return e+t*a[0]+n*(a[0]*a[1])}function se(e,t){return(e%t+t)%t}var oe={M:function(){function e(){Object(h.a)(this,e),this.max_neighbours=26}return Object(_.a)(e,[{key:"count_neighbours",value:function(e,t,n,a,r,i){for(var s=0,o=-1;o<=1;o++)for(var c=-1;c<=1;c++)for(var u=-1;u<=1;u++)if(0!==o||0!==c||0!==u){var l=r[ie(se(e+o,a[0]),se(t+c,a[1]),se(n+u,a[2]),a)];i.is_neighbour(l)&&(s+=1)}return s}},{key:"on_location_update",value:function(e,t,n,a,r){for(var i=-1;i<=1;i++)for(var s=-1;s<=1;s++)for(var o=-1;o<=1;o++){var c=ie(se(e+i,a[0]),se(t+s,a[1]),se(n+o,a[2]),a);r.add(c)}}}]),e}(),VN:function(){function e(){Object(h.a)(this,e),this.offsets=[];for(var t=0;t<3;t++){var n=[0,0,0],a=[0,0,0];n[t]=1,a[t]=-1,this.offsets.push(n),this.offsets.push(a)}this.max_neighbours=6}return Object(_.a)(e,[{key:"count_neighbours",value:function(e,t,n,a,r,i){var s,o=0,c=Object(y.a)(this.offsets);try{for(c.s();!(s=c.n()).done;){var u=s.value,l=r[ie(se(e+u[0],a[0]),se(t+u[1],a[1]),se(n+u[2],a[2]),a)];i.is_neighbour(l)&&(o+=1)}}catch(h){c.e(h)}finally{c.f()}return o}},{key:"on_location_update",value:function(e,t,n,a,r){var i=ie(e,t,n,a);r.add(i);var s,o=Object(y.a)(this.offsets);try{for(o.s();!(s=o.n()).done;){var c=s.value;i=ie(se(e+c[0],a[0]),se(t+c[1],a[1]),se(n+c[2],a[2]),a),r.add(i)}}catch(u){o.e(u)}finally{o.f()}}}]),e}()},ce=function(){function e(t){Object(h.a)(this,e),this.generate(t)}return Object(_.a)(e,[{key:"generate",value:function(e){var t=(e=e.replace(" ","")).split("/");if(4!==t.length)throw new Error("Invalid string rule: ".concat(e));var n=Object(w.a)(t,4),a=n[0],r=n[1],i=n[2],s=n[3];if(!(s in oe))throw new Error("Invalid neighbourhood rule: ".concat(s));this.total_states=Number(i),this.remain_alive=this.retrieve_rule(a),this.become_alive=this.retrieve_rule(r),this.neighbour_type=new oe[s]}},{key:"retrieve_rule",value:function(e){var t=new Array(27);t.fill(!1,0,-1);var n,a=e.split(","),r=Object(y.a)(a);try{for(r.s();!(n=r.n()).done;){var i=n.value.split("-").map(Number);if(1===i.length){var s=i[0];this.assert_number(s),t[s]=!0}else{if(2!==i.length)throw new Error("Too many numbers in range: ".concat(e,". Must be 1 or 2"));var o=Object(w.a)(i,2),c=o[0],u=o[1];if(u<c)throw new Error("Invalid range: ".concat(c,"-").concat(u,". Must be ordered."));for(var l=c;l<=u;l++)this.assert_number(l),t[l]=!0}}}catch(h){r.e(h)}finally{r.f()}return t}},{key:"assert_number",value:function(e){if(e<0||e>26)throw new Error("Invalid number: ".concat(e,". Must be between 0 to 26"))}}]),e}(),ue=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(h.a)(this,e),this.params=t}return Object(_.a)(e,[{key:"update",value:function(e){for(var t in e){var n=e[t];this.params[t].value=n}this.params=Object(q.a)({},this.params)}}]),e}(),le=function(e){Object(f.a)(n,e);var t=Object(d.a)(n);function n(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.2,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;return Object(h.a)(this,n),(e=t.call(this,{density:new $(0,1,a),radius:new $(0,.5,r)})).type="Seed Crystal",e.alive_state=1,e.dead_state=0,e}return Object(_.a)(n,[{key:"randomise",value:function(e){for(var t=this.params.radius.value,n=this.params.density.value,a=[Math.max(.5-t,0),Math.min(.5+t,1)],r=a[0],i=a[1],s=e.shape[0]-1,o=e.shape[1]-1,c=e.shape[2]-1,u=[Math.floor(s*r),Math.ceil(s*i)],l=u[0],h=u[1],_=[Math.floor(o*r),Math.ceil(o*i)],d=_[0],f=_[1],v=[Math.floor(c*r),Math.ceil(c*i)],m=v[0],p=v[1],g=l;g<=h;g++)for(var b=d;b<=f;b++)for(var y=m;y<=p;y++){var w=e.xyz_to_i(g,b,y);Math.random()<n?e.cells[w]=this.alive_state:e.cells[w]=this.dead_state}}}]),n}(ue),he=function(e){Object(f.a)(n,e);var t=Object(d.a)(n);function n(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.2,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;return Object(h.a)(this,n),(e=t.call(this,{density:new $(0,1,a),radius:new $(0,100,r)})).type="Seed Crystal Absolute",e.alive_state=1,e.dead_state=0,e}return Object(_.a)(n,[{key:"randomise",value:function(e){for(var t=this.params.radius.value,n=this.params.density.value,a=Math.floor(e.shape[0]/2),r=Math.floor(e.shape[1]/2),i=Math.floor(e.shape[2]/2),s=[Math.max(a-t,0),Math.min(a+t,e.shape[0]-1)],o=s[0],c=s[1],u=[Math.max(r-t,0),Math.min(r+t,e.shape[1]-1)],l=u[0],h=u[1],_=[Math.max(i-t,0),Math.min(i+t,e.shape[2]-1)],d=_[0],f=_[1],v=o;v<=c;v++)for(var m=l;m<=h;m++)for(var p=d;p<=f;p++){var g=e.xyz_to_i(v,m,p);Math.random()<n?e.cells[g]=this.alive_state:e.cells[g]=this.dead_state}}}]),n}(ue),_e=function(){function e(t){Object(h.a)(this,e),this.entries=[],this.randomiser_manager=t,this.add_entry(new de("445","4/4/5/M",new le(.05,.5))),this.add_entry(new de("678 678","6-8/6-8/3/M",new le(.3))),this.add_entry(new de("Amoeba","9-26/5-7,12-13,15/5/M",new he(.3,5))),this.add_entry(new de("Builder 1","2,6,9/4,6,8-9/10/M",new he(.35,7))),this.add_entry(new de("Builder 2","6,9/4,6,8-9/10/M",new he(.35,7))),this.add_entry(new de("Clouds 1","13-26/13-14,17-19/2/M",new le(.5,.5))),this.add_entry(new de("Spiky Growth","0-3,7-9,11-13,18,21-22,24-26/4,13,17,20-24,24/4/M",new he(.8,1))),this.add_entry(new de("Crystal Growth 1","0-6/1,3/2/VN",new he(1,1))),this.add_entry(new de("Crystal Growth 2","1-3/1-3/5/VN",new he(1,1))),this.add_entry(new de("Pyroclastic","4-7/6-8/10/M",new he(.2,5))),this.add_entry(new de("Slow Decay","8,11,13-26/13-26/5/M",new le(.45,1))),this.select_entry(0)}return Object(_.a)(e,[{key:"get_selected_entry",value:function(){return this.entries[this.selected_entry]}},{key:"select_entry",value:function(e){this.selected_entry=e;var t=this.get_selected_entry().randomiser;this.randomiser_manager.select_randomiser(t)}},{key:"add_entry",value:function(e){var t=e.randomiser,n=e.rule;t.alive_state=n.alive_state,t.dead_state=n.dead_state,this.entries.push(e)}}]),e}(),de=function e(t,n,a){var r=this;Object(h.a)(this,e),this.name=t,this.description=n,this.rule_reader=new ce(n),this.rule=new re((function(e){return r.rule_reader.remain_alive[e]}),(function(e){return r.rule_reader.become_alive[e]}),this.rule_reader.total_states,this.rule_reader.neighbour_type),this.randomiser=a},fe=function(){function e(t){Object(h.a)(this,e),this.store=t,this.data={completed_blocks:0,frame_time:0,total_blocks:0,total_steps:0}}return Object(_.a)(e,[{key:"force_update",value:function(){var e=this;this.store.dispatch((function(t){setTimeout((function(){t({type:"stats.update",value:e})}),0)}))}},{key:"recieve",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;void 0!==t?this.recieve_key(e,t):this.recieve_batch(e)}},{key:"recieve_key",value:function(e,t){this.data[e]=t,this.data=Object(q.a)({},this.data),this.force_update()}},{key:"recieve_batch",value:function(e){for(var t in e){var n=e[t];this.data[t]=n}this.data=Object(q.a)({},this.data),this.force_update()}}]),e}(),ve=function(){function e(){Object(h.a)(this,e),this.entries=[],this.add_randomiser(new le),this.add_randomiser(new he),this.selected_index=0}return Object(_.a)(e,[{key:"add_randomiser",value:function(e){this.entries.push({name:e.type,instance:e})}},{key:"select_randomiser",value:function(e){var t=this;this.entries.map((function(e,t){return[e,t]})).filter((function(t){var n=Object(w.a)(t,2),a=n[0];n[1];return a.instance.type===e.type})).map((function(e){var t=Object(w.a)(e,2),n=t[0],a=t[1];return[n.instance,a]})).forEach((function(n){var a=Object(w.a)(n,2),r=a[0],i=a[1],s={};Object.entries(e.params).forEach((function(e){var t=Object(w.a)(e,2),n=t[0],a=t[1];s[n]=a.value})),r.update(s),t.select(i)}))}},{key:"select",value:function(e){this.selected_index=e}},{key:"set_params",value:function(e){this.selected_randomiser.update(e)}},{key:"selected_randomiser",get:function(){return this.entries[this.selected_index].instance}}]),e}(),me=function(){function e(t,n){Object(h.a)(this,e),this.gl=t,this.store=n,t.enable(t.DEPTH_TEST),t.enable(t.BLEND),t.enable(t.CULL_FACE),t.cullFace(t.BACK),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),this.renderer=new v(t),this.camera=new p,this.shader_manager=new ee(t,this.camera),this.randomiser_manager=new ve,this.rule_browser=new _e(this.randomiser_manager),this.stats=new fe(this.store);this.set_size(m.c.fromValues(100,100,100)),this.show_border=new Z(!0),this.show_render=new Z(!0),this.shader_manager.select_colouring(2),this.rule_browser.select_entry(2),this.sim.randomise()}return Object(_.a)(e,[{key:"set_size",value:function(e){var t=this.gl;this.size=e,this.shader_manager.set_size(this.size),this.sim=new S(t,this.size,this.camera,this.shader_manager,this.rule_browser,this.randomiser_manager,this.stats),this.border=new Y(t,this.size,this.renderer,this.camera),this.camera.model_translation=m.c.create(),m.c.scale(this.camera.model_translation,this.size,-.5),m.c.scale(this.camera.view_position,this.size,.5),m.c.add(this.camera.view_position,this.camera.view_position,m.c.fromValues(20,20,20))}},{key:"run",value:function(){requestAnimationFrame(this.loop.bind(this))}},{key:"loop",value:function(){this.on_update(),this.on_render(),requestAnimationFrame(this.loop.bind(this))}},{key:"on_update",value:function(){this.sim.on_update()}},{key:"on_render",value:function(){this.renderer.clear(),this.show_border.value&&this.border.on_render(),this.show_render.value&&this.sim.on_render()}}]),e}();var pe=function(e){Object(f.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(h.a)(this,n),(a=t.call(this,e)).canvas_ref=r.a.createRef(),a.rotating=!1,a.zooming=!1,a.mouse_start_pos=m.b.create(),a.total_touches=0,a.touch_start_pos=m.b.create(),a.touch_zoom_distance=0,a.touch_list=[],a}return Object(_.a)(n,[{key:"componentDidMount",value:function(){var e=this.canvas_ref.current,t=e.getContext("webgl2");if(!t)throw new Error("WebGL not supported");var n,a,r,i,s,c=new me(t,Se),u=Object(o.c)({app:(s=c,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"step":e.sim.step();break;case"stop":e.sim.stop();break;case"start":e.sim.start();break;case"toggle":e.sim.toggle();break;case"clear":e.sim.clear();break;case"randomise":e.sim.randomise();break;case"app.set_size":e.set_size(t.value);break;case"app.show_border":e.show_border.value=t.value;break;case"app.show_render":e.show_render.value=t.value}return e}),rule_browser:(i=c.rule_browser,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"rule.select":var n=t.value;e.select_entry(n)}return e}),shader_manager:(r=c.shader_manager,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"shader.select_render_type":e.select_render_type(t.value);break;case"shader.select_colouring":e.select_colouring(t.value);break;case"shader.select_shading":e.select_shading(t.value);break;case"shader.set_param":e.set_param(t.name,t.value)}return e}),stats:(a=c.stats,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"stats.update":return t.value}return e}),randomiser:(n=c.randomiser_manager,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"randomiser.select":e.select(t.value);break;case"randomiser.update":e.set_params(t.value)}return e})});Se.replaceReducer(u),c.run(),this.camera=c.camera;var l=e.clientWidth,h=e.clientHeight;this.camera.aspect_ratio=l/h}},{key:"on_mouse_down",value:function(e){this.rotating=!0,this.mouse_start_pos[0]=e.clientX,this.mouse_start_pos[1]=e.clientY}},{key:"on_mouse_move",value:function(e){if(this.rotating&&this.mouse_start_pos){var t=m.b.fromValues(e.clientX,e.clientY),n=m.b.create();m.b.sub(n,this.mouse_start_pos,t),m.b.scale(n,n,.005),this.camera.rotate(n[0],n[1]),this.mouse_start_pos=t}}},{key:"on_wheel",value:function(e){var t=.001*e.deltaY;this.camera.zoom(t)}},{key:"on_touch_start",value:function(e){var t,n=e.touches;if((t=this.touch_list).push.apply(t,Object(l.a)(n)),this.total_touches+=n.length,1===this.total_touches){this.rotating=!0,this.zooming=!1;var a=this.touch_list[this.touch_list.length-1];this.touch_start_pos=m.b.fromValues(a.clientX,a.clientY)}else if(this.total_touches>=2){this.zooming=!0,this.rotating=!1;var r=this.touch_list.slice(this.touch_list.length-2,this.touch_list.length);this.touch_zoom_distance=this.calculate_touch_distance.apply(this,Object(l.a)(r))}}},{key:"calculate_touch_distance",value:function(e,t){var n=m.b.fromValues(e.clientX,e.clientY),a=m.b.fromValues(t.clientX,t.clientY),r=m.b.create();return m.b.sub(r,n,a),m.b.length(r)}},{key:"on_touch_end",value:function(e){this.rotating=!1,this.zooming=!1,this.touch_list=[],this.total_touches=0,this.total_touches<2&&(this.zooming=!1),this.total_touches<1&&(this.rotating=!1)}},{key:"on_touch_move",value:function(e){(this.rotating||this.zooming)&&(this.rotating?this.on_touch_rotate(e):this.zooming&&this.on_touch_zoom(e))}},{key:"on_touch_rotate",value:function(e){if(!(e.touches.length<1)){var t=e.touches[0],n=m.b.fromValues(t.clientX,t.clientY),a=m.b.create();m.b.sub(a,this.touch_start_pos,n),m.b.scale(a,a,.005),this.camera.rotate(a[0],a[1]),this.touch_start_pos=n}}},{key:"on_touch_zoom",value:function(e){var t=e.touches,n=this.touch_zoom_distance;if(t.length>=2)n=this.calculate_touch_distance(t[0],t[1]);else{var a=t[0],r=this.touch_list[this.touch_list.length-2],i=this.touch_list[this.touch_list.length-1],s=this.calculate_touch_distance(r,a),o=this.calculate_touch_distance(i,a);s<o?(this.touch_list[this.touch_list.length-2]=a,n=o):(this.touch_list[this.touch_list.length-1]=a,n=s)}var c=n/this.touch_zoom_distance;this.touch_zoom_distance=n,this.camera.zoom(1-c)}},{key:"render",value:function(){var e=this;return r.a.createElement("canvas",{width:800,height:800,ref:this.canvas_ref,onMouseDown:function(t){return e.on_mouse_down(t)},onMouseUp:function(t){return e.rotating=!1},onMouseMove:function(t){return e.on_mouse_move(t)},onWheel:function(t){return e.on_wheel(t)},onTouchStart:function(t){return e.on_touch_start(t)},onTouchMove:function(t){return e.on_touch_move(t)},onTouchEnd:function(t){return e.on_touch_end(t)}})}}]),n}(r.a.Component);function ge(){var e=Object(c.c)((function(e){return e.app.sim.running})),t=Object(c.b)(),n=e?"Pause":"Run",a=e?"danger":"success";return r.a.createElement("div",{className:"btn-group"},r.a.createElement("button",{className:"btn btn-secondary",onClick:function(){return t({type:"step"})}},"Step"),r.a.createElement("button",{className:"btn btn-primary",onClick:function(){return t({type:"randomise"})}},"Randomise"),r.a.createElement("button",{className:"btn btn-warning",onClick:function(){return t({type:"clear"})}},"Clear"),r.a.createElement("button",{className:"btn btn-"+a,onClick:function(){return t({type:"toggle"})}},n))}function be(){var e=Object(c.c)((function(e){return e.rule_browser})),t=Object(c.c)((function(e){return e.rule_browser.selected_entry})),n=Object(c.b)();var a=e.entries.map((function(e,a){return function(e,a){var i=a===t?"active":"";return r.a.createElement("li",{className:"list-group-item "+i,key:a,onClick:function(){return n({type:"rule.select",value:a})}},r.a.createElement("div",null,"Name: ",e.name),r.a.createElement("div",null,"Rule: ",e.description))}(e,a)}));return r.a.createElement("ul",{className:"list-group"},a)}function ye(e,t,n,a){switch(e.type){case"slider":return function(e,t,n,a){var i=(e.max-e.min)/100;return r.a.createElement("div",{className:"form-inline",key:t},r.a.createElement("label",null,n,": ",e.value.toFixed(2)),r.a.createElement("input",{className:"form-control-range",type:"range",min:e.min,max:e.max,value:e.value,step:i,onChange:function(e){return a(Number(e.target.value))}}))}(e,t,n,a);case"toggle":return function(e,t,n,a){return r.a.createElement("div",{className:"form-check",key:t},r.a.createElement("input",{type:"checkbox",className:"form-check-input",checked:e.value,onChange:function(e){return a(e.target.checked)}}),r.a.createElement("label",{className:"form-check-label"},n))}(e,t,n,a);default:return}}function we(){var e=Object(c.b)(),t=Object(c.c)((function(e){return e.shader_manager.render_types})),n=Object(c.c)((function(e){return e.shader_manager.current_render_type})),a=Object(c.c)((function(e){return e.shader_manager.colourings})),i=Object(c.c)((function(e){return e.shader_manager.current_colouring})),s=Object(c.c)((function(e){return e.shader_manager.shadings})),o=Object(c.c)((function(e){return e.shader_manager.current_shading}));var u=t.map((function(e,t){return r.a.createElement("option",{value:t,key:"render_type_".concat(t)},e.name)})),l=a.map((function(e,t){return r.a.createElement("option",{value:t,key:"colouring_".concat(t)},e)})),h=s.map((function(e,t){return r.a.createElement("option",{value:t,key:"shading_".concat(t)},e)}));return r.a.createElement("div",{className:"card"},r.a.createElement("div",{className:"card-header"},"Shaders"),r.a.createElement("div",{className:"card-body"},r.a.createElement("form",{className:"form-inline"},r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{className:"mr-2"},"Colouring "),r.a.createElement("select",{className:"custom-select custom-select-sm",value:i,onChange:function(t){var n=t.target.value;e({type:"shader.select_colouring",value:n})}},l))),r.a.createElement("form",{className:"form-inline"},r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{className:"mr-2"},"Shading "),r.a.createElement("select",{className:"custom-select custom-select-sm",value:o,onChange:function(t){var n=t.target.value;e({type:"shader.select_shading",value:n})}},h))),r.a.createElement("form",{className:"form-inline"},r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{className:"mr-2"},"Render Type "),r.a.createElement("select",{className:"custom-select custom-select-sm",value:n,onChange:function(t){var n=t.target.value;e({type:"shader.select_render_type",value:n})}},u))),r.a.createElement("hr",null),r.a.createElement(Ee,null)))}function Ee(){var e=Object(c.b)(),t=Object(c.c)((function(e){return e.shader_manager.params}));var n=Object.entries(t).map((function(t,n){var a=Object(w.a)(t,2),r=a[0];return ye(a[1],n,r,(function(t){!function(t,n){e({type:"shader.set_param",name:t,value:n})}(r,t)}))}));return r.a.createElement("form",null,n)}function xe(){var e=Object(c.b)(),t=Object(c.c)((function(e){return e.app.size})),n=Object(a.useState)(t[0]),i=Object(w.a)(n,2),s=i[0],o=i[1],u=Object(a.useState)(t[1]),l=Object(w.a)(u,2),h=l[0],_=l[1],d=Object(a.useState)(t[2]),f=Object(w.a)(d,2),v=f[0],p=f[1];function g(e){var t=Number(e);return t=Math.max(t,1),t=Math.min(t,1e3)}return r.a.createElement("form",{className:"form-group",onSubmit:function(t){return function(t){var n=g(s),a=g(h),r=g(v);o(n),_(a),p(r);var i=m.c.fromValues(n,a,r);e({type:"app.set_size",value:i}),t.preventDefault()}(t)}},r.a.createElement("input",{type:"number",value:s,max:1e3,min:1,onChange:function(e){return o(e.target.value)}}),r.a.createElement("input",{type:"number",value:h,max:1e3,min:1,onChange:function(e){return _(e.target.value)}}),r.a.createElement("input",{type:"number",value:v,max:1e3,min:1,onChange:function(e){return p(e.target.value)}}),r.a.createElement("button",{type:"submit",className:"btn btn-primary"},"Apply"))}function ke(){var e=Object(c.c)((function(e){return e.stats.data.completed_blocks})),t=Object(c.c)((function(e){return e.stats.data.total_blocks})),n=Object(c.c)((function(e){return e.stats.data.frame_time})),a=Object(c.c)((function(e){return e.stats.data.total_steps})),i=0;return t>0&&(i=e/t*100),r.a.createElement("div",{className:"card"},r.a.createElement("div",{className:"card-header"},"Statistics"),r.a.createElement("div",{className:"card-body"},r.a.createElement("div",null,"Total Steps: ",a),r.a.createElement("div",null,"Progress: ",e,"/",t," (",i.toFixed(2),"%)"),r.a.createElement("div",null,"Frame Time (ms): ",n.toFixed(2))))}function Oe(){var e=Object(c.b)(),t=Object(c.c)((function(e){return e.randomiser.selected_index}));var n=Object(c.c)((function(e){return e.randomiser.entries})).map((function(e,t){return r.a.createElement("option",{value:t,key:t},e.name)}));return r.a.createElement("div",{className:"card"},r.a.createElement("div",{className:"card-header"},"Randomiser"),r.a.createElement("div",{className:"card-body"},r.a.createElement("form",null,r.a.createElement("div",{className:"form-inline"},r.a.createElement("label",{className:"mr-2"},"Randomiser"),r.a.createElement("select",{className:"custom-select custom-select-sm",value:t,onChange:function(t){var n=t.target.value;e({type:"randomiser.select",value:n})}},n))),r.a.createElement("hr",null),r.a.createElement(je,null)))}function je(){var e=Object(c.b)(),t=Object(c.c)((function(e){return e.randomiser.selected_randomiser.params}));var n=Object.entries(t).map((function(t,n){var a=Object(w.a)(t,2),r=a[0];return ye(a[1],n,r,(function(t){!function(t,n){var a={};a[t]=Number(n),e({type:"randomiser.update",value:a})}(r,t)}))}));return r.a.createElement("form",null,n)}function Te(){var e=Object(c.b)(),t=Object(c.c)((function(e){return e.app.show_border})),n=Object(c.c)((function(e){return e.app.show_render}));Object(c.c)((function(e){return e.app.show_border.value})),Object(c.c)((function(e){return e.app.show_render.value}));return r.a.createElement("div",null,ye(t,0,"Show Border",(function(t){e({type:"app.show_border",value:t})})),ye(n,1,"Show Render",(function(t){e({type:"app.show_render",value:t})})))}var Se=Object(o.e)((function(){}),Object(o.d)(Object(o.a)(u.a)));function Ne(){var e=Object(c.c)((function(e){return e}));return r.a.createElement("div",null,r.a.createElement("div",{className:"row"},e?r.a.createElement("div",{className:"col-sm"},r.a.createElement(ge,null),r.a.createElement(xe,null),r.a.createElement(Te,null),r.a.createElement(we,null),r.a.createElement(Oe,null),r.a.createElement(ke,null)):r.a.createElement("div",null),r.a.createElement("div",{className:"col-sm"},r.a.createElement(pe,null)),e?r.a.createElement("div",{className:"col-sm"},r.a.createElement(be,null)):r.a.createElement("div",null)))}s.a.render(r.a.createElement(c.a,{store:Se},r.a.createElement(Ne,null)),document.getElementById("root"))}},[[28,1,2]]]);
//# sourceMappingURL=main.a39d2576.chunk.js.map